<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://java.sun.com/jsf/facelets">

<f:metadata>
	<f:viewParam name="realmID" value="#{realmDetails.paramRealmID}" />
</f:metadata>

<f:view>
	<ui:composition template="/realmsTemplate.xhtml">

		<ui:define name="header_content">
			<script src="http://maps.google.com/maps/api/js?sensor=false" type="text/javascript"></script>
		</ui:define>

		<ui:define name="content">
			<center>
					<p:panel styleClass="normal_text" style="width: 80%">
						<f:facet name="header">
							<h:outputFormat value="#{msgs['realm.edit.title']}">
								<f:param value="#{realmDetails.realm.name}" />
							</h:outputFormat>
						</f:facet>
						<p:gmap center="#{realmDetails.mapParams.center}" zoom="#{realmDetails.mapParams.zoom}" type="ROADMAP"
							model="#{realmDetails.mapModel}"
							onPointClick="handlePointClick(event);" widgetVar="detailsMap"
							style="width:1300px;height:700px">
							<p:ajax event="stateChange" listener="#{realmDetails.onStateChange}" />
						</p:gmap>

						<p:dialog widgetVar="dlg" effect="FADE" effectDuration="0.5"
							close="false" fixedCenter="true">
							<h:form prependId="false">
								<h:panelGrid columns="2">
									<h:outputLabel for="title" value="Title:" />
									<p:inputText id="title" value="#{realmDetails.viewParamTitle}" />

									<f:facet name="footer">
										<p:commandButton value="Add"
											actionListener="#{realmDetails.addMarker}" oncomplete="markerAddComplete()" />
										<p:commandButton value="Cancel" onclick="return cancel()" />
									</f:facet>
								</h:panelGrid>

								<h:inputHidden id="lat" value="#{realmDetails.viewParamLat}" />
								<h:inputHidden id="lng" value="#{realmDetails.viewParamLong}" />
							</h:form>
						</p:dialog>
						
					<script type="text/javascript">
				var currentMarker = null;
	
				function handlePointClick(event) {
					if(currentMarker == null) {
						document.getElementById('lat').value = event.latLng.lat();
						document.getElementById('lng').value = event.latLng.lng();

						currentMarker = new google.maps.Marker({
							position:new google.maps.LatLng(event.latLng.lat(), event.latLng.lng())
						});
							
						detailsMap.addOverlay(currentMarker);

						dlg.show();
					}	
				}

				function markerAddComplete() {
					var title = document.getElementById('title');
					currentMarker.setTitle(title.value);
					title.value = "";

					currentMarker = null;
					dlg.hide();
				}

				function cancel() {
					dlg.hide();
					currentMarker.setMap(null);
					currentMarker = null;

					return false;
				}
			</script>
						
					</p:panel>
			</center>
		</ui:define>

	</ui:composition>

</f:view>
</html>
